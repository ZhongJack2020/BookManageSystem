{"remainingRequest":"D:\\Project\\BookManage\\front_end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Project\\BookManage\\front_end\\src\\views\\Login.vue?vue&type=style&index=0&id=26084dc2&scoped=true&lang=css&","dependencies":[{"path":"D:\\Project\\BookManage\\front_end\\src\\views\\Login.vue","mtime":1671621197492},{"path":"D:\\Project\\BookManage\\front_end\\node_modules\\css-loader\\dist\\cjs.js","mtime":1671623705886},{"path":"D:\\Project\\BookManage\\front_end\\node_modules\\vue-loader\\lib\\loaders\\stylePostLoader.js","mtime":1671623707520},{"path":"D:\\Project\\BookManage\\front_end\\node_modules\\postcss-loader\\src\\index.js","mtime":1671623705999},{"path":"D:\\Project\\BookManage\\front_end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1671623711960},{"path":"D:\\Project\\BookManage\\front_end\\node_modules\\vue-loader\\lib\\index.js","mtime":1671623706360}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:CgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKCgoKLmxpbmsgewogIHBvc2l0aW9uOiBhYnNvbHV0ZTsKICBib3R0b206IDA7CiAgbGVmdDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIDApOwp9CgoubG9naW5fY29udGFpbmVyIHsKICBiYWNrZ3JvdW5kLWltYWdlOiB1cmwoJy4uL2Fzc2V0cy9ib29rQkcuanBnJyk7CiAgYmFja2dyb3VuZC1yZXBlYXQ6IG5vLXJlcGVhdDsKICBiYWNrZ3JvdW5kLXNpemU6IDEwMCUgMTAwJTsKICBoZWlnaHQ6IDEwMCU7CiAgdXNlci1zZWxlY3Q6IG5vbmU7Cn0KCi5sb2dpbl9ib3ggewogIHBvc2l0aW9uOiByZWxhdGl2ZTsKICBiYWNrZ3JvdW5kLWNvbG9yOiByZ2JhKDIyLCAyMiwgMjIsIDAuMzIyKTsKICBib3gtc2hhZG93OiAwIDAgMS4zcmVtICNhYWE7CiAgcGFkZGluZy10b3A6IDJyZW07CiAgcGFkZGluZy1sZWZ0OiAzLjVyZW07CiAgcGFkZGluZy1yaWdodDogMy41cmVtOwogIHBhZGRpbmctYm90dG9tOiA1cmVtOwogIGJvcmRlci1yYWRpdXM6IDFyZW07CiAgd2lkdGg6IDI1cmVtOwogIGhlaWdodDogMTUuOHJlbTsKICB0b3A6IDUwJTsKICBsZWZ0OiA1MCU7CiAgdHJhbnNmb3JtOiB0cmFuc2xhdGUoLTUwJSwgLTUwJSk7CiAgdGV4dC1hbGlnbjogY2VudGVyOwogIGxpbmUtaGVpZ2h0OiA0cmVtOwp9CgoucmVnaXN0ZXJfYm94IHsKICBwb3NpdGlvbjogZml4ZWQ7CiAgYmFja2dyb3VuZC1jb2xvcjogcmdiYSgyMiwgMjIsIDIyLCAwLjMyMik7CiAgYm94LXNoYWRvdzogMCAwIDEuM3JlbSAjYWFhOwogIHBhZGRpbmctdG9wOiAxcmVtOwogIHBhZGRpbmctbGVmdDogNnJlbTsKICBwYWRkaW5nLXJpZ2h0OiA2cmVtOwogIHBhZGRpbmctYm90dG9tOiAxMHJlbTsKICBib3JkZXItcmFkaXVzOiAxcmVtOwogIHdpZHRoOiAyMnJlbTsKICBoZWlnaHQ6IDIwLjhyZW07CiAgdG9wOiA1MCU7CiAgbGVmdDogNTAlOwogIHRyYW5zZm9ybTogdHJhbnNsYXRlKC01MCUsIC01MCUpOwogIHRleHQtYWxpZ246IGNlbnRlcjsKICBsaW5lLWhlaWdodDogNHJlbTsKfQoKc3BhbiB7CiAgZm9udC1mYW1pbHk6ICdTVEhlaXRpJzsKICBmb250LXNpemU6IDEuNXJlbTsKfQoKLmJ0bnMgewogIHBhZGRpbmctdG9wOiAxcmVtOwp9Cg=="},{"version":3,"sources":["Login.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAySA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"Login.vue","sourceRoot":"src/views","sourcesContent":["<template>\r\n  <div class=\"login_container\">\r\n    <transition-group appear name=\"animate__animated animated__bounce \" enter-active-class=\"animate__fadeIn\"\r\n      leave-active-class=\"animate__fadeOutDown\">\r\n      <div class=\"login_box\" key=\"1\" v-if=\"isOnLogin\">\r\n        <div class=\"form\">\r\n          <span>图书管理系统</span>\r\n          <el-form @submit.prevent='' ref='loginForRef' :model=\"loginData\" :rules=\"loginFormRules\" label-width>\r\n            <el-form-item prop=\"mail_num\">\r\n              <el-input @keydown.enter.native=\"login\" placeholder=\"邮箱地址\" v-model.trim=\"loginData.mail_num\"\r\n                prefix-icon=\"el-icon-user-solid\">\r\n              </el-input>\r\n            </el-form-item>\r\n            <el-form-item prop=\"password\">\r\n              <el-input @keydown.enter.native=\"login\" placeholder=\"密码\" v-model.trim=\"loginData.password\" type=\"password\"\r\n                prefix-icon=\"el-icon-s-promotion\">\r\n              </el-input>\r\n            </el-form-item>\r\n            <el-form-item class=\"btns\">\r\n              <el-button :round=\"false\" :circle=\"false\" type=\"primary\" size=\"medium\" @click=\"login\">登录<i\r\n                  class=\"el-icon-upload el-icon--right\"></i></el-button>\r\n            </el-form-item>\r\n            <el-link class=\"link\" target=\"_blank\" @click=\"switchStatus\">还没有账户？点击注册</el-link>\r\n          </el-form>\r\n        </div>\r\n      </div>\r\n    </transition-group>\r\n    <div class=\"register_box\" v-if=\"!isOnLogin\">\r\n      <span>新用户注册</span>\r\n      <el-form @submit.prevent='' ref='registerForRef' :model=\"registerData\" :rules=\"registerFormRules\" label-width>\r\n        <el-form-item prop=\"stu_id\">\r\n          <el-input placeholder=\"学号\" v-model.trim=\"registerData.stu_id\" prefix-icon=\"el-icon-user-solid\">\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"name\">\r\n          <el-input placeholder=\"昵称\" v-model.trim=\"registerData.name\" prefix-icon=\"el-icon-s-promotion\">\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"password\">\r\n          <el-input show-password placeholder=\"密码\" type=\"password\" v-model.trim=\"registerData.password\"\r\n            prefix-icon=\"el-icon-s-promotion\">\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"mail_num\">\r\n          <el-input placeholder=\"邮箱地址\" v-model.trim=\"registerData.mail_num\" prefix-icon=\"el-icon-s-promotion\">\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item prop=\"vali\">\r\n          <el-input :disabled=\"!isGetValidate\" placeholder=\"请先获取验证码（ 注意大小写 ）\" v-model.trim=\"registerData.vali\"\r\n            prefix-icon=\"el-icon-s-promotion\">\r\n          </el-input>\r\n        </el-form-item>\r\n        <el-form-item class=\"btns\">\r\n          <el-button v-if=\"registerData.mail_num\" :disabled=\"isFreqValidate\" :round=\"false\" :circle=\"false\"\r\n            type=\"primary\" size=\"medium\" @click=\"getValidate\" style=\"float:left;\">\r\n            获取验证码<i class=\"el-icon-magic-stick el-icon--right\"></i></el-button>\r\n          <el-button :disabled=\"!registerData.vali\" v-if=\"isGetValidate&&registerData.mail_num\" :round=\"false\"\r\n            :circle=\"false\" type=\"primary\" size=\"medium\" @click=\"register\" style=\"float:right\">\r\n            确认注册 <i class=\"el-icon-key el-icon--right\"></i></el-button>\r\n        </el-form-item>\r\n        <el-link class=\"link\" style=\"\" target=\"_blank\" @click=\"switchStatus\">已有账户？ 点击登录</el-link>\r\n      </el-form>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import 'animate.css'\r\n  import {\r\n    mapState,\r\n    mapMutations,\r\n    mapGetters,\r\n    mapActions\r\n  } from 'vuex'\r\n  export default {\r\n    data() {\r\n      return {\r\n        // 登录表单的数据绑定对象\r\n        loginData: {\r\n          mail_num: '',\r\n          password: ''\r\n        },\r\n        // 注册表单验证对象\r\n        registerData: {\r\n          stu_id: '',\r\n          name: '',\r\n          mail_num: '',\r\n          vali: '',\r\n          password: ''\r\n        },\r\n        // 用户当前是否正准备登录\r\n        isOnLogin: true,\r\n        // 用户当前是否已经拿到验证码\r\n        isGetValidate: false,\r\n        // 防止用户频繁请求验证\r\n        isFreqValidate: false,\r\n        // 登录表单验证规则对象\r\n        loginFormRules: {\r\n          mail_num: [{\r\n              required: true,\r\n              message: '请输入邮箱地址',\r\n              trigger: 'blur'\r\n            },\r\n            {\r\n              min: 8,\r\n              message: '邮箱地址长度不合法',\r\n              trigger: 'blur'\r\n            }\r\n          ],\r\n          password: [{\r\n              required: true,\r\n              message: '请输入密码',\r\n              trigger: 'blur'\r\n            },\r\n            {\r\n              min: 5,\r\n              max: 15,\r\n              message: '密码长度不合法',\r\n              trigger: 'blur'\r\n            }\r\n          ]\r\n        },\r\n        // 注册表单验证规则对象\r\n        registerFormRules: {\r\n          stu_id: [{\r\n              required: true,\r\n              message: '请输入您的学号',\r\n              trigger: 'blur'\r\n            },\r\n            {\r\n              min: 7,\r\n              max: 9,\r\n              message: '学号长度不合法',\r\n              trigger: 'blur'\r\n            }\r\n          ],\r\n          name: [{\r\n              required: true,\r\n              message: '请输入你的昵称',\r\n              trigger: 'blur'\r\n            },\r\n            {\r\n              min: 0,\r\n              max: 20,\r\n              message: '昵称长度不合法',\r\n              trigger: 'blur'\r\n            }\r\n          ],\r\n          mail_num: [{\r\n              required: true,\r\n              message: '请输入邮箱地址',\r\n              trigger: 'blur'\r\n            },\r\n            {\r\n              min: 8,\r\n              message: '邮箱地址不合法',\r\n              trigger: 'blur'\r\n            }\r\n          ],\r\n          vali: [{\r\n              required: true,\r\n              message: '请输入验证码',\r\n              trigger: 'blur'\r\n            },\r\n            {\r\n              min: 3,\r\n              message: '验证码不合法',\r\n              trigger: 'blur'\r\n            }\r\n          ],\r\n          password: [{\r\n              required: true,\r\n              message: '请输入密码',\r\n              trigger: 'blur'\r\n            },\r\n            {\r\n              min: 5,\r\n              max: 15,\r\n              message: '密码长度不合法',\r\n              trigger: 'blur'\r\n            }\r\n          ]\r\n        }\r\n      }\r\n    },\r\n    methods: {\r\n      ...mapMutations('userAbout', {\r\n        saveInfo: 'SAVE'\r\n      }),\r\n      // 用户登录\r\n      login() {\r\n        let submit = {\r\n          \"user\": {\r\n            \"mail_num\": this.loginData.mail_num,\r\n            \"password\": this.loginData.password\r\n          }\r\n        }\r\n        this.$refs.loginForRef.validate(async valid => {\r\n          if (!valid) return\r\n          await this.$http.post(this.baseUrl+'/userlogin', submit).then(res => {\r\n            window.localStorage.setItem('token', res.data.token)\r\n            window.localStorage.setItem('id', res.data.id)\r\n            window.localStorage.setItem('name', res.data.name)\r\n            this.saveInfo()\r\n            this.$message.success({\r\n              message: '登录成功',\r\n              duration: 1000\r\n            })\r\n            this.$router.push('/home')\r\n          }).catch(err => {\r\n            if (err) {\r\n              this.$message.error({\r\n                message: '登录失败',\r\n                duration: 1500\r\n              })\r\n            }\r\n          })\r\n        })\r\n      },\r\n      switchStatus() {\r\n        // 切换界面\r\n        this.isOnLogin = !this.isOnLogin\r\n      },\r\n      // 用户注册并提交验证码\r\n      async register() {\r\n        let key = window.localStorage.getItem('_one_key')\r\n        let submit = {\r\n          \"user\": {\r\n            \"name\": this.registerData.name,\r\n            \"password\": this.registerData.password,\r\n            \"mail_num\": this.registerData.mail_num,\r\n            \"vali\": this.registerData.vali,\r\n            key,\r\n            \"stu_id\": this.registerData.stu_id\r\n          }\r\n        }\r\n        this.$refs.registerForRef.validate(async valid => {\r\n          if (!valid) {\r\n            return\r\n          }\r\n          await this.$http.post(this.baseUrl+'/userregister', submit).then(res => {\r\n            window.localStorage.setItem('token', res.data.token)\r\n            window.localStorage.setItem('id', res.data.id)\r\n            window.localStorage.setItem('name', this.registerData.name)\r\n            this.saveInfo()\r\n            this.$message.success({\r\n              message: '注册成功',\r\n              duration: 2000\r\n            })\r\n            this.$router.push('/home')\r\n          }).catch((err, a) => {\r\n            if (err) {\r\n              this.$message.error({\r\n                message: '注册失败',\r\n                duration: 1500\r\n              })\r\n            }\r\n          })\r\n        })\r\n      },\r\n      // 获取验证码\r\n      async getValidate() {\r\n        this.$refs.registerForRef.validateField('mail_num', async valid => {\r\n          if (valid)\r\n            return\r\n          this.isFreqValidate = !this.isFreqValidate\r\n          // 20s后允许再次请求\r\n          setTimeout(() => {\r\n            this.isFreqValidate = !this.isFreqValidate\r\n          }, 1000 * 20)\r\n          // 获取时间戳来为服务器标识本次验证码的请求时间\r\n          let time = new Date().getTime();\r\n          let data = {\r\n            mail: this.registerData.mail_num,\r\n            timestamp: time\r\n          }\r\n          const res = await this.$http.post(this.baseUrl+'/validateMail', data)\r\n          if (res.status === 200) {\r\n            this.isGetValidate = true\r\n            window.localStorage.setItem('_one_key', res.data)\r\n            this.$message.info({\r\n              message: '验证码发送成功',\r\n              duration: 2000\r\n            })\r\n          } else {\r\n            this.$message.error({\r\n              message: '验证码发送失败',\r\n              duration: 2000\r\n            })\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .link {\r\n    position: absolute;\r\n    bottom: 0;\r\n    left: 50%;\r\n    transform: translate(-50%, 0);\r\n  }\r\n\r\n  .login_container {\r\n    background-image: url('../assets/bookBG.jpg');\r\n    background-repeat: no-repeat;\r\n    background-size: 100% 100%;\r\n    height: 100%;\r\n    user-select: none;\r\n  }\r\n\r\n  .login_box {\r\n    position: relative;\r\n    background-color: rgba(22, 22, 22, 0.322);\r\n    box-shadow: 0 0 1.3rem #aaa;\r\n    padding-top: 2rem;\r\n    padding-left: 3.5rem;\r\n    padding-right: 3.5rem;\r\n    padding-bottom: 5rem;\r\n    border-radius: 1rem;\r\n    width: 25rem;\r\n    height: 15.8rem;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    text-align: center;\r\n    line-height: 4rem;\r\n  }\r\n\r\n  .register_box {\r\n    position: fixed;\r\n    background-color: rgba(22, 22, 22, 0.322);\r\n    box-shadow: 0 0 1.3rem #aaa;\r\n    padding-top: 1rem;\r\n    padding-left: 6rem;\r\n    padding-right: 6rem;\r\n    padding-bottom: 10rem;\r\n    border-radius: 1rem;\r\n    width: 22rem;\r\n    height: 20.8rem;\r\n    top: 50%;\r\n    left: 50%;\r\n    transform: translate(-50%, -50%);\r\n    text-align: center;\r\n    line-height: 4rem;\r\n  }\r\n\r\n  span {\r\n    font-family: 'STHeiti';\r\n    font-size: 1.5rem;\r\n  }\r\n\r\n  .btns {\r\n    padding-top: 1rem;\r\n  }\r\n</style>"]}]}