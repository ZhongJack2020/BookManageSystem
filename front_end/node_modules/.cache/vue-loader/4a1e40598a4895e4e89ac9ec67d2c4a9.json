{"remainingRequest":"D:\\Project\\BookManage\\front_end\\node_modules\\vue-loader\\lib\\index.js??vue-loader-options!D:\\Project\\BookManage\\front_end\\src\\views\\user\\BorrowBook.vue?vue&type=script&lang=js&","dependencies":[{"path":"D:\\Project\\BookManage\\front_end\\src\\views\\user\\BorrowBook.vue","mtime":1671621197494},{"path":"D:\\Project\\BookManage\\front_end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1671623711960},{"path":"D:\\Project\\BookManage\\front_end\\node_modules\\babel-loader\\lib\\index.js","mtime":1671623706785},{"path":"D:\\Project\\BookManage\\front_end\\node_modules\\cache-loader\\dist\\cjs.js","mtime":1671623711960},{"path":"D:\\Project\\BookManage\\front_end\\node_modules\\vue-loader\\lib\\index.js","mtime":1671623706360}],"contextDependencies":[],"result":[{"type":"Buffer","data":"base64:Ly8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KLy8KCmltcG9ydCB7CiAgbWFwU3RhdGUsCiAgbWFwTXV0YXRpb25zLAogIG1hcEdldHRlcnMsCiAgbWFwQWN0aW9ucwp9IGZyb20gJ3Z1ZXgnCmV4cG9ydCBkZWZhdWx0IHsKICBpbmplY3Q6IFsncmVsb2FkJ10sCiAgZGF0YSgpIHsKICAgIHJldHVybiB7CiAgICAgIGJvb2tOYW1lOiAnJywKICAgICAgYm9va0xpc3Q6IFtdLAogICAgICBpc0ZpbmQ6IGZhbHNlLAogICAgICBsb2FkaW5nOiB0cnVlCiAgICB9CiAgfSwKICBjb21wdXRlZDp7CiAgICAuLi5tYXBTdGF0ZSgndXNlckFib3V0JywgWydpZCddKQogIH0sCiAgbWV0aG9kczogewogICAgYXN5bmMgZmluZEJvb2soKSB7CiAgICAgIGlmICh0aGlzLmJvb2tOYW1lLnRyaW0oKS5sZW5ndGggPT09IDApIHsKICAgICAgICByZXR1cm4gdGhpcy4kbWVzc2FnZS5pbmZvKHsKICAgICAgICAgIG1lc3NhZ2U6ICfor7fovpPlhaXkvaDopoHmn6Xor6LnmoTlm77kuaYnLAogICAgICAgICAgZHVyYXRpb246IDE1MDAKICAgICAgICB9KQogICAgICB9CiAgICAgIGxldCBzdWJtaXQgPSB0aGlzLmJvb2tOYW1lCiAgICAgIGNvbnN0IHJlcyA9IGF3YWl0IHRoaXMuJGh0dHAuZ2V0KHRoaXMuYmFzZVVybCtgL2ZpbmRCb29rP25hbWU9JHtzdWJtaXR9YCkKICAgICAgaWYgKHJlcy5kYXRhLmxlbmd0aCA9PT0gMCkgewogICAgICAgIHJldHVybiB0aGlzLmlzRmluZCA9IGZhbHNlCiAgICAgIH0KICAgICAgdGhpcy5pc0ZpbmQgPSB0cnVlCiAgICAgIHRoaXMuYm9va0xpc3QgPSByZXMuZGF0YQogICAgICB0aGlzLmxvYWRpbmcgPSBmYWxzZQogICAgfSwKICAgIGFzeW5jIHNob3dCb29rSW5mbyhyb3cpIHsKICAgICAgY29uc3QgcmVzID0gYXdhaXQgdGhpcy4kaHR0cC5nZXQodGhpcy5iYXNlVXJsK2AvZ2V0Qm9va0luZm8/Ym9va19pZD0ke3Jvdy5ib29rX2lkfWApCiAgICAgIGlmIChyZXMuZGF0YS5ib29rX2luZm8gPT09IG51bGwgfHwgcmVzLmRhdGEuYm9va19pbmZvLnRyaW0oKS5sZW5ndGggPT09IDApIHsKICAgICAgICByZXMuZGF0YS5ib29rX2luZm8gPSAn5pqC5peg6K+m5oOF5L+h5oGvJwogICAgICB9CiAgICAgIHRoaXMuJGFsZXJ0KGAke3Jlcy5kYXRhLmJvb2tfaW5mb31gLCAn5Lmm5pys6K+m5oOFJykKICAgIH0sCiAgICBhc3luYyBib3Jyb3dCb29rKHJvdykgewogICAgICB0aGlzLiRjb25maXJtKGDnoa7lrpropoHlgJ/pmIXov5nmnKwgJHtyb3cuYXV0aG9yfSDnmoQgJHtyb3cuYm9va19uYW1lfSDlkJfvvJ9gLCAn5o+Q56S6JywgewogICAgICAgIGNvbmZpcm1CdXR0b25UZXh0OiAn56Gu5a6aJywKICAgICAgICBjYW5jZWxCdXR0b25UZXh0OiAn5Y+W5raIJywKICAgICAgICB0eXBlOiAnaW5mbycKICAgICAgfSkudGhlbihhc3luYyAoKSA9PiB7CiAgICAgICAgbGV0IHN1Ym1pdCA9IHsKICAgICAgICAgIGJvb2tfaWQ6IHJvdy5ib29rX2lkLAogICAgICAgICAgaWQ6dGhpcy5pZAogICAgICAgIH0KICAgICAgICBjb25zdCByZXMgPSBhd2FpdCB0aGlzLiRodHRwLnBvc3QodGhpcy5iYXNlVXJsK2Avc3VibWl0Qm9ycm93UmVxYCwgc3VibWl0KQogICAgICAgIGlmIChyZXMuc3RhdHVzID09PSAyMDApIHsKICAgICAgICAgIHRoaXMuJG1lc3NhZ2Uuc3VjY2Vzcyh7CiAgICAgICAgICAgIG1lc3NhZ2U6ICfor7fmsYLmj5DkuqTmiJDlip8nLAogICAgICAgICAgICBkdXJhdGlvbjogMTAwMAogICAgICAgICAgfSkKICAgICAgICAgIHNldFRpbWVvdXQoKCkgPT4gewogICAgICAgICAgdGhpcy5yZWxvYWQoKQogICAgICAgIH0sIDUwMCkKICAgICAgICAgIHJldHVybiAKICAgICAgICB9IGVsc2UgewogICAgICAgICAgcmV0dXJuIHRoaXMuJG1lc3NhZ2UuZXJyb3IoewogICAgICAgICAgICBtZXNzYWdlOiAn6K+35rGC5aSx6LSlLOivt+eojeWQjuWGjeivlScsCiAgICAgICAgICAgIGR1cmF0aW9uOiAxMDAwCiAgICAgICAgICB9KQogICAgICAgIH0KICAgICAgfSkuY2F0Y2goKCkgPT4gewogICAgICAgIHRoaXMuJG1lc3NhZ2UuaW5mbyh7CiAgICAgICAgICBtZXNzYWdlOiAn5bey5Y+W5raIJywKICAgICAgICAgIGR1cmF0aW9uOiAxMDAwCiAgICAgICAgfSkKICAgICAgfSkKCiAgICB9CiAgfQp9Cg=="},{"version":3,"sources":["BorrowBook.vue"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAmCA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA","file":"BorrowBook.vue","sourceRoot":"src/views/user","sourcesContent":["<template>\r\n  <div>\r\n    <div style=\"text-align:center;\"><span class=\"gray-title\">B M 阅 览 室</span></div>\r\n    <!-- 用户查询区 -->\r\n    <el-row :gutter=\"15\" style=\"margin:2rem 2rem 0 2rem\">\r\n      <el-col :span=\"21\">\r\n        <el-input @keydown.enter.native=\"findBook\" placeholder=\"请输入查询的图书\" prefix-icon=\"el-icon-search\"\r\n          v-model=\"bookName\">\r\n        </el-input>\r\n      </el-col>\r\n      <el-col :span=\"3\">\r\n        <el-button plain @click=\"findBook\">点我查询</el-button>\r\n      </el-col>\r\n    </el-row>\r\n    <!-- 空状态显示区 -->\r\n    <el-empty v-if=\"!isFind\" :image-size=\"200\" style=\"margin-top: 2rem;user-select:none;\"></el-empty>\r\n    <!-- 结果显示区 -->\r\n    <el-table class=\"book-table\" :data=\"bookList\" v-if=\"isFind\" border stripe v-loading=\"loading\" style=\"width: 100%;\">\r\n      <el-table-column type=\"index\" label=\"#\"></el-table-column>\r\n      <el-table-column label=\"书名\" prop=\"book_name\"></el-table-column>\r\n      <el-table-column label=\"图书编号\" prop=\"book_id\"></el-table-column>\r\n      <el-table-column label=\"作者\" prop=\"author\"></el-table-column>\r\n      <el-table-column label=\"操作\">\r\n        <template slot-scope=\"scope\">\r\n          <div class=\"user-ctrl\">\r\n            <el-link type=\"primary\" @click=\"showBookInfo(scope.row)\">查看详情</el-link>\r\n            <el-link type=\"primary\" @click=\"borrowBook(scope.row)\">借阅</el-link>\r\n          </div>\r\n        </template>\r\n      </el-table-column>\r\n    </el-table>\r\n  </div>\r\n</template>\r\n\r\n<script>\r\n  import {\r\n    mapState,\r\n    mapMutations,\r\n    mapGetters,\r\n    mapActions\r\n  } from 'vuex'\r\n  export default {\r\n    inject: ['reload'],\r\n    data() {\r\n      return {\r\n        bookName: '',\r\n        bookList: [],\r\n        isFind: false,\r\n        loading: true\r\n      }\r\n    },\r\n    computed:{\r\n      ...mapState('userAbout', ['id'])\r\n    },\r\n    methods: {\r\n      async findBook() {\r\n        if (this.bookName.trim().length === 0) {\r\n          return this.$message.info({\r\n            message: '请输入你要查询的图书',\r\n            duration: 1500\r\n          })\r\n        }\r\n        let submit = this.bookName\r\n        const res = await this.$http.get(this.baseUrl+`/findBook?name=${submit}`)\r\n        if (res.data.length === 0) {\r\n          return this.isFind = false\r\n        }\r\n        this.isFind = true\r\n        this.bookList = res.data\r\n        this.loading = false\r\n      },\r\n      async showBookInfo(row) {\r\n        const res = await this.$http.get(this.baseUrl+`/getBookInfo?book_id=${row.book_id}`)\r\n        if (res.data.book_info === null || res.data.book_info.trim().length === 0) {\r\n          res.data.book_info = '暂无详情信息'\r\n        }\r\n        this.$alert(`${res.data.book_info}`, '书本详情')\r\n      },\r\n      async borrowBook(row) {\r\n        this.$confirm(`确定要借阅这本 ${row.author} 的 ${row.book_name} 吗？`, '提示', {\r\n          confirmButtonText: '确定',\r\n          cancelButtonText: '取消',\r\n          type: 'info'\r\n        }).then(async () => {\r\n          let submit = {\r\n            book_id: row.book_id,\r\n            id:this.id\r\n          }\r\n          const res = await this.$http.post(this.baseUrl+`/submitBorrowReq`, submit)\r\n          if (res.status === 200) {\r\n            this.$message.success({\r\n              message: '请求提交成功',\r\n              duration: 1000\r\n            })\r\n            setTimeout(() => {\r\n            this.reload()\r\n          }, 500)\r\n            return \r\n          } else {\r\n            return this.$message.error({\r\n              message: '请求失败,请稍后再试',\r\n              duration: 1000\r\n            })\r\n          }\r\n        }).catch(() => {\r\n          this.$message.info({\r\n            message: '已取消',\r\n            duration: 1000\r\n          })\r\n        })\r\n\r\n      }\r\n    }\r\n  }\r\n</script>\r\n\r\n<style scoped>\r\n  .gray-title {\r\n    position: relative;\r\n    user-select: none;\r\n    color: darkgray;\r\n    text-shadow: 5px 5px 5px gray;\r\n    font-size: 2rem;\r\n    padding: 1rem 0 1rem 0;\r\n    line-height: 4rem;\r\n  }\r\n\r\n  .book-table {\r\n    margin-top: 2rem;\r\n    border-radius: 0.5rem;\r\n  }\r\n\r\n  .user-ctrl {\r\n    display: flex;\r\n    justify-content: space-around;\r\n  }\r\n</style>"]}]}